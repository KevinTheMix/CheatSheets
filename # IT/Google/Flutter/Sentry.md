# Sentry

## Quick Tips

* Monitoring
  * Explore > [Releases](https://kalex-corp.sentry.io/explore/releases)
  * Insights > [Project Details](https://kalex-corp.sentry.io/insights/projects/timewalk)

## Glossary

* **Authentication Token** = token required for using Sentry CLI (can be created/revoked via  <https://kalex-corp.sentry.io/settings/auth-tokens>)
* **Debug Information File** = generated by --split-debug-info (eg `flutter build {platform} --obfuscate --split-debug-info={symbols_folder}`)
* **Debug Symbol** = symbol necessary to parse stack trace
* **DSN** (Data Source Name) = Sentry URL endpoints towards which relevant information is sent (no authentication required)
  * Found via <https://{org}.sentry.io/settings/projects/{project}> then Settings (hover don't click) > SDK Setup > Client Keys (DSN aka Data Source Name)
  * Found in <https://{org}.sentry.io/settings/projects/{project}/keys>
* **dSYM** (debug SYMbol) = Apple debug symbols
* **In-App** = application code vs **Not In-App** = framework, SDK, system libraries
* **PII** (Personaly Identifiable Information) = request headers and IP for users (see <https://docs.sentry.io/platforms/dart/data-management/data-collected>)
* **Proguard** = open-source Android shrink/minify/optimize/obfuscate CLI
* **R8** = Android app optimizer/compiler (shrink/minify, remove unused code & resources, rewrite optimized code) Java tool
* **Sentry CLI** = administrative tool (eg to upload symbols/sources/maps or delete projects)
* **Source Context** = sources uploaded to display inline context (surrounding code snippets) in stack traces (by setting  **upload_sources** to true)
  * Uploading sources _after_ errors were already sent to Sentry (without sources) retroactively add sources to those exceptions
* **Stack Frame** = each entry in a call stack (ie active non-inline function calls/hops)

## Configuration

* [Sentry Dart Plugin (Config file)](https://github.com/getsentry/sentry-dart-plugin/tree/main)
* [Sentry Dart Plugin (Setup)](https://docs.sentry.io/platforms/dart/guides/flutter/debug-symbols/dart-plugin)
* [sqflite integration](https://docs.sentry.io/platforms/dart/guides/flutter/integrations/sqflite-instrumentation)
* [Troubleshooting](https://docs.sentry.io/platforms/dart/guides/flutter/troubleshooting)

### Install

Run following command:

```powershell
$downloadUrl = "https://github.com/getsentry/sentry-wizard/releases/download/v5.1.0/sentry-wizard-win-x64.exe"
Invoke-WebRequest $downloadUrl -OutFile sentry-wizard.exe
./sentry-wizard.exe -i flutter
```

* Adds _sentry\flutter_ & _sentry\_dart\_plugin_ (as dev dependency) packages in _pubspec.yaml_
* Creates a _sentry.properties_ file holding **auth_token**
* Modifies _main.dart_ with top-level Sentry handling (and DSN)
* Includes one sample error (to remove afterwards)

### Configuration Properties

Sentry configuration sections can coexist in multiple locations (properties chosen granularly by order of priority):

* Environment variables (**SENTRY_PROJECT**, **SENTRY_ORG**, **SENTRY_AUTH_TOKEN**)
* _pubspec.yaml_ (eg `sentry: key: value`)
* _sentry.properties_ (eg `key=value` and **don't append trailing comments**, holds **auth_token**, git-ignored)

### Properties

* **upload_debug_symbols** = allows interpreting obfuscated stack traces (files, functions, line numbers)
* **upload_source_maps** (web applications only) = translates minified (Javascript) code back to original source code
* **upload_sources** = helps display source code snippets in stack traces (aka Source Context)
* **project** = project name
* **org** = company names
* **auth_token** = token required for using Sentry CLI administrative tool
* **log_level** = logging level (ie _trace_, _debug_, _info_, _warn_, _error_)
* **symbols_path** = folder holding symbols (as specified via `--split-debug-info`)
* **build_path** = folder holding debug files to upload (apparently can be used as workaround if upload fails for some debug information files)
* **dart_symbol_map_path** = path to Dart obfuscation map file to upload (for Android/iOS, as generated via `--extra-gen-snapshot-options=--save-obfuscation-map`)

## Usage

* (`flutter clean`)
* `flutter build windows --obfuscate --split-debug-info={symbols_folder}`
* `flutter build windows --obfuscate --split-debug-info=build\windows\symbols --extra-gen-snapshot-options=--save-obfuscation-map=build/app/obfuscation.map.json`
* `dart run sentry_dart_plugin` (using Dart SDK Plugin instead of Sentry CLI)

### [CLI](https://docs.sentry.io/cli)

## Community

* [Infinite recursion in SentrySqfliteDatabaseFactory](https://github.com/issues/created?issue=getsentry%7Csentry-dart%7C3229) (**Fixed** by _buenaflor_)
  * (obsolete: <Alert>You may need to specify `databaseFactory = SentrySqfliteDatabaseFactory(databaseFactory: databaseFactory);` instead to work around a known recursion bug (version 9.6.0) causing a stack overflow.</Alert>)
* [Clarifying how to get to transactions page](https://github.com/getsentry/sentry-docs/pull/14802)
